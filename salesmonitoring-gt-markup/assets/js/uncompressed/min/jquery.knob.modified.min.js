$(function(){function a(a){return $.isNumeric(a)?a*Math.PI/180:0}var t=function(a,e){var n,i,o,r,l=null,s=a[0].getContext("2d"),d=2*Math.PI,c=this;this.onChange=function(){},this.onCancel=function(){},this.onRelease=function(){},this.val=function(a){if(null==a){var t,s;return t=s=Math.atan2(n-o,-(i-r-e.width/2))-e.angleOffset,0>s&&(t=s+d),a=Math.round(t*(e.max-e.min)/d)+e.min,a>e.max?e.max:a}e.stopper&&(a=Math.max(Math.min(a,e.max),e.min)),l=a,this.onChange(a),e.dynamicDraw?this.dynamicDraw(a):this.draw(a)},this.change=function(a){e.stopper&&(a=Math.max(Math.min(a,e.max),e.min)),this.onChange(a),this.draw(a)},this.angle=function(a){return(a-e.min)*d/(e.max-e.min)},this.draw=function(a){var n,i=this.angle(a),o=1.5*Math.PI+e.angleOffset,r=o,c=o+this.angle(l),u=r+i,h=e.width/2,f=h*e.thickness,g=t.getCgColor(e.cgColor);if(s.clearRect(0,0,e.width,e.width),s.lineWidth=f,!e.draw(i,l,e,s)){for(n=0;n<e.ticks;n++){s.beginPath(),s.strokeStyle=i>2*Math.PI/e.ticks*n&&e.tickColorizeValues?e.fgColor:e.tickColor;var v=2*Math.PI/e.ticks*n-.5*Math.PI;s.arc(h,h,h-f-e.tickLength,v,v+e.tickWidth,!1),s.stroke()}switch(e.cursor&&(o=c-.3)&&(c+=.3)&&(r=u-.3)&&(u+=.3),e.skin){case"default":s.beginPath(),s.strokeStyle=e.bgColor,s.arc(h,h,h-f/2,0,d,!0),s.stroke(),e.displayPrevious&&(s.beginPath(),s.strokeStyle=l==a?e.fgColor:g,s.arc(h,h,h-f/2,o,c,!1),s.stroke()),s.beginPath(),s.strokeStyle=e.fgColor,s.arc(h,h,h-f/2,r,u,!1),s.stroke();break;case"tron":e.displayPrevious&&(s.beginPath(),s.strokeStyle=l==a?e.fgColor:g,s.arc(h,h,h-f,o,c,!1),s.stroke()),s.beginPath(),s.strokeStyle=e.fgColor,s.arc(h,h,h-f,r,u,!1),s.stroke(),s.lineWidth=2,s.beginPath(),s.strokeStyle=e.fgColor,s.arc(h,h,h-f+1+2*f/3,0,2*Math.PI,!1),s.stroke()}}};var u,h;this.dynamicDraw=function(a){var t=this;u=e.min,h=setInterval(function(){t.animateDraw(a)},20)},this.animateDraw=function(){u>l?(clearInterval(h),l=u):(this.draw(u),this.change(u),u++)},this.capture=function(a){switch(a.type){case"mousemove":case"mousedown":n=a.pageX,i=a.pageY;break;case"touchmove":case"touchstart":n=a.originalEvent.touches[0].pageX,i=a.originalEvent.touches[0].pageY}this.change(this.val())},this.cancel=function(){c.val(l),c.onCancel()},this.startDrag=function(t){var n=a.offset(),i=$(document);o=n.left+e.width/2,r=n.top,this.capture(t),i.bind("mousemove.dial touchmove.dial",function(a){c.capture(a)}).bind("keyup.dial",function(a){27===a.keyCode&&(i.unbind("mouseup.dial mousemove.dial keyup.dial"),c.cancel())}).bind("mouseup.dial touchend.dial",function(){i.unbind("mousemove.dial touchmove.dial mouseup.dial touchend.dial keyup.dial"),c.val(c.val()),c.onRelease(l)})}};t.getCgColor=function(a){a=a.substring(1,7);var t=[parseInt(a.substring(0,2),16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)];return"rgba("+t[0]+","+t[1]+","+t[2]+",.5)"},$.fn.knob=$.fn.dial=function(e){return this.each(function(){var n,i=$(this);if(i.data("dialed"))return i;i.data("dialed",!0),n=$.extend({min:i.data("min")||0,max:i.data("max")||100,stopper:!0,readOnly:i.data("readonly"),cursor:i.data("cursor"),thickness:i.data("thickness")||.35,width:i.data("width")||200,displayInput:null==i.data("displayinput")||i.data("displayinput"),displayPrevious:i.data("displayprevious"),fgColor:i.data("fgcolor")||"#87CEEB",cgColor:i.data("cgcolor")||i.data("fgcolor")||"#87CEEB",bgColor:i.data("bgcolor")||"#EEEEEE",tickColor:i.data("tickColor")||i.data("fgcolor")||"#DDDDDD",ticks:i.data("ticks")||0,tickLength:i.data("tickLength")||0,tickWidth:i.data("tickWidth")||.02,tickColorizeValues:i.data("tickColorizeValues")||!0,skin:i.data("skin")||"default",angleOffset:a(i.data("angleoffset")),dynamicDraw:i.data("dynamicdraw")||!1,draw:function(){},change:function(){},release:function(){}},e);var o,r=$('<canvas width="'+n.width+'" height="'+n.width+'"></canvas>'),l=$("<div style=width:"+n.width+'px;display:inline;"></div>'),s=i.val(),d=function(){n.displayInput&&i.css({width:n.width/2+"px",position:"absolute","margin-top":5*n.width/14+"px","margin-left":"-"+3*n.width/4+"px","font-size":n.width/4+"px",border:"none",background:"none","font-family":"Arial","font-weight":"bold","text-align":"center",color:n.fgColor,padding:"0px","-webkit-appearance":"none"})||i.css({width:"0px",visibility:"hidden"})};if(i.wrap(l).before(r),d(),o=new t(r,n),s||(s=n.min),i.val(s),o.val(s),o.onRelease=function(a){n.release(a,i)},o.onChange=function(a){i.val(a),n.change(a)},i.bind("change",function(){o.val(i.val())}),n.readOnly)i.attr("readonly","readonly");else{r.bind("mousedown touchstart",function(a){a.preventDefault(),o.startDrag(a)}).bind("mousewheel DOMMouseScroll",mw=function(a){a.preventDefault();var t=a.originalEvent,e=t.detail||t.wheelDeltaX,n=t.detail||t.wheelDeltaY,r=parseInt(i.val())+(e>0||n>0?1:0>e||0>n?-1:0);o.val(r)});var c,u,h=1,f={37:-1,38:1,39:1,40:-1};i.bind("configure",function(a,t){var e;for(e in t)n[e]=t[e];d(),o.val(i.val())}).bind("keydown",function(a){var t=a.keyCode;t>=96&&105>=t&&(t-=48),c=parseInt(String.fromCharCode(t)),isNaN(c)&&(13!==t&&8!==t&&9!==t&&189!==t&&a.preventDefault(),$.inArray(t,[37,38,39,40])>-1&&(o.change(parseInt(i.val())+f[t]*h),u=window.setTimeout(function(){20>h&&h++},50),a.preventDefault()))}).bind("keyup",function(a){isNaN(c)?u?(window.clearTimeout(u),u=null,h=1,o.val(i.val()),o.onRelease(i.val(),i)):13===a.keyCode&&o.onRelease(i.val(),i):i.val()>n.max&&i.val(n.max)||i.val()<n.min&&i.val(n.min)}).bind("mousewheel DOMMouseScroll",mw)}}).parent()}});